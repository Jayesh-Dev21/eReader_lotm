<task>
Android Kotlin app: Offline Kindle-style reader for "Lord of the Mysteries" novel.
</task>

<stack>
Kotlin + Jetpack Compose + Room DB + Jsoup + Retrofit + DataStore + Navigation Compose
</stack>

<requirements>
1. OFFLINE-FIRST:
   - One-time scrape from https://ranobes.top/novels/133485-lord-of-the-mysteries-v812312.html
   - Store all chapters in Room DB (id, title, content, orderIndex)
   - 100% offline after initial data load
   - Bash script (scrape_and_populate.sh) for adding new books

2. READING MODES (user-selectable):
   A. CONTINUOUS SCROLL: Infinite LazyColumn, auto-load next chapter at end
   B. PAGINATED: Screen-sized pages, swipe/tap to flip, page counter
   - Save position: scroll offset (A) or page number (B)
   - Preserve position when switching modes

3. UI FEATURES:
   - Chapter list screen (LazyColumn)
   - Reader screen (mode-aware: ContinuousReader.kt / PaginatedReader.kt)
   - Settings: reading mode toggle, font size (12-28sp), font family (Serif/Sans/Mono), Light/Dark theme
   - Tap center = hide/show UI (immersive)
   - Tap edges / swipe = next/prev chapter (optional)
   - Progress indicator (Chapter X/Y, page count)

4. PERSISTENCE:
   - DataStore: last chapter, scroll offset OR page number, reading mode, font prefs, theme
   - Auto-save with 2s debounce

5. PROJECT STRUCTURE:
   /data/local/         â†’ AppDatabase, ChapterDao, ChapterEntity, DataStoreManager
   /data/repository/    â†’ BookRepository
   /data/scraper/       â†’ NovelScraper (Jsoup)
   /data/models/        â†’ ReadingMode enum, ReadingPreferences data class
   /ui/screens/         â†’ ChapterListScreen, ReaderScreen, SettingsScreen
   /ui/components/      â†’ ContinuousReader, PaginatedReader, ProgressIndicator
   /ui/viewmodels/      â†’ ChapterListVM, ReaderVM, SettingsVM
   /ui/theme/           â†’ Theme, Color, Type (Material 3 Light/Dark)
   /utils/              â†’ TextPaginator (page calculation), GestureDetector
   /navigation/         â†’ NavGraph
   /scripts/            â†’ scrape_and_populate.sh
   /docs/               â†’ IMPLEMENTATION.md (all explanations)

6. TECHNICAL NOTES:
   - Min SDK 26, Target SDK 34
   - TextPaginator splits text by screen height
   - Continuous mode: detect scroll end, append next chapter
   - Paginated mode: HorizontalPager or custom gesture Box
   - Mode switch: convert scroll offset â†” page number
   - Clean Material 3 design, smooth animations
</requirements>

<bash_script>
./scrape_and_populate.sh <URL>
- Fetch HTML, parse with Jsoup, output JSON
- Insert into Room DB or generate prepopulated DB
- Reusable for any novel (parameterized selectors)
</bash_script>

<output>
Generate ALL Kotlin files (complete code, no placeholders, TODO comments for expansion).
Generate IMPLEMENTATION.md (structure overview, how components work, setup guide, architecture decisions).
NO inline explanations in codeâ€”all docs in IMPLEMENTATION.md.
</output>

<success_criteria>
- Compiles on Android 8.0+
- Scrapes LoTM chapters successfully
- Both reading modes work smoothly
- Position persists across restarts
- Mode switching preserves position
- Theme/font updates live
- Bash script adds new books
</success_criteria>

<execute>
Generate complete project now. No intervention needed.
</execute>
```

---

## ðŸŽ¯ Usage Instructions

**If this still hits length limit**, break it into **2 sequential prompts**:

### Prompt 1 (Setup + Data Layer):
```
Create Android Kotlin app structure: Room DB (ChapterEntity, ChapterDao, AppDatabase), DataStoreManager (save reading position/prefs), NovelScraper (Jsoup), BookRepository, ReadingMode enum. Include scrape_and_populate.sh bash script. Target: offline book reader for Lord of the Mysteries.
```

### Prompt 2 (UI + Logic):
```
Build Compose UI: ChapterListScreen, ReaderScreen with 2 modes (ContinuousReader: infinite scroll LazyColumn, PaginatedReader: swipeable pages with TextPaginator), SettingsScreen (reading mode toggle, font size/family, Light/Dark theme). ViewModels for state. Navigation. Save position (scroll offset or page number) in DataStore. Material 3 design. Generate IMPLEMENTATION.md.